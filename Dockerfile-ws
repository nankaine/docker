# 使用 node:16.20.2-buster 基础镜像
FROM node:16.20.2-buster

# 设置环境变量以避免交互式安装
ENV DEBIAN_FRONTEND=noninteractive

# 安装 ADB 以及其他必要的包
RUN apt update && \
    apt install -y --no-install-recommends android-tools-adb git && \
    npm install -g node-gyp && \
    # 清理 apt 缓存以减少镜像大小
    apt clean && \
    rm -rf /var/lib/apt/lists/*

# 设置工作目录
WORKDIR /ws-scrcpy

# 克隆仓库并安装依赖
RUN git clone https://github.com/NetrisTV/ws-scrcpy.git . && \
    npm install

# 构建项目（如果有构建步骤）
RUN npm run build || echo "No build script found, skipping build step"

# 暴露端口
EXPOSE 8000

# 默认命令
CMD ["node", "dist/index.js"]
